/** Notice * This file contains works from many authors under various (but compatible) licenses. Please see core.txt for more information. **/
(function(){(window.wpCoreControlsBundle=window.wpCoreControlsBundle||[]).push([[22],{651:function(ya,ua,h){h.r(ua);var ma=h(0),na=h(7),oa=h(2);ya=h(53);var ja=h(37),ia=h(20);h=function(){function fa(){this.init()}fa.prototype.init=function(){this.kva=!1;this.Yg=this.Sp=this.connection=null;this.Wl={};this.ha=this.AQ=null};fa.prototype.YH=function(z){for(var y=this,n=0;n<z.length;++n){var e=z[n];switch(e.at){case "create":this.Wl[e.author]||(this.Wl[e.author]=e.aName);this.zHa(e);break;case "modify":this.ha.yt(e.xfdf).then(function(a){y.ha.Eb(a[0])});
break;case "delete":e="<delete><id>".concat(e.aId,"</id></delete>"),this.ha.yt(e)}}};fa.prototype.zHa=function(z){var y=this;this.ha.yt(z.xfdf).then(function(n){n=n[0];n.authorId=z.author;y.ha.Eb(n);y.ha.trigger(na.d.UPDATE_ANNOTATION_PERMISSION,[n])})};fa.prototype.oGa=function(z,y,n){this.Sp&&this.Sp(z,y,n)};fa.prototype.preloadAnnotations=function(z){this.addEventListener("webViewerServerAnnotationsEnabled",this.oGa.bind(this,z,"add",{imported:!1}),{once:!0})};fa.prototype.initiateCollaboration=
function(z,y,n){var e=this;if(z){e.Yg=y;e.ha=n.ia();n.addEventListener(na.i.DOCUMENT_UNLOADED,function(){e.disableCollaboration()});e.yXa(z);var a=new XMLHttpRequest;a.addEventListener("load",function(){if(200===a.status&&0<a.responseText.length)try{var f=JSON.parse(a.responseText);e.connection=exports.da.cZa(Object(ja.l)(e.Yg,"blackbox/"),"annot");e.AQ=f.id;e.Wl[f.id]=f.user_name;e.ha.B0(f.id);e.connection.L1a(function(r){r.t&&r.t.startsWith("a_")&&r.data&&e.YH(r.data)},function(){e.connection.send({t:"a_retrieve",
dId:z});e.trigger(fa.Events.WEBVIEWER_SERVER_ANNOTATIONS_ENABLED,[e.Wl[f.id],e.AQ])},function(){e.disableCollaboration()})}catch(r){Object(oa.f)(r.message)}});a.open("GET",Object(ja.l)(this.Yg,"demo/SessionInfo.jsp"));a.withCredentials=!0;a.send();e.kva=!0;e.ha.Zha(function(f){return e.Wl[f.Author]||f.Author})}else Object(oa.f)("Document ID required for collaboration")};fa.prototype.disableCollaboration=function(){this.Sp&&(this.ha.removeEventListener(ia.a.Events.ANNOTATION_CHANGED,this.Sp),this.Sp=
null);this.connection&&this.connection.Rv();this.ha&&this.ha.B0("Guest");this.init();this.trigger(fa.Events.WEBVIEWER_SERVER_ANNOTATIONS_DISABLED)};fa.prototype.yXa=function(z){var y=this;this.Sp&&this.ha.removeEventListener(ia.a.Events.ANNOTATION_CHANGED,this.Sp);this.Sp=function(n,e,a){return Object(ma.b)(this,void 0,void 0,function(){var f,r,b,w,ba,ca,ha,x,aa;return Object(ma.d)(this,function(ea){switch(ea.label){case 0:if(a.imported)return[2];f={t:"a_".concat(e),dId:z,annots:[]};return[4,y.ha.Z9()];
case 1:r=ea.aa();"delete"!==e&&(b=(new DOMParser).parseFromString(r,"text/xml"),w=new XMLSerializer);for(ba=0;ba<n.length;ba++)ca=n[ba],x=ha=void 0,"add"===e?(ha=b.querySelector('[name="'.concat(ca.Id,'"]')),x=w.serializeToString(ha),aa=null,ca.InReplyTo&&(aa=y.ha.Yf(ca.InReplyTo).authorId||"default"),f.annots.push({at:"create",aId:ca.Id,author:y.AQ,aName:y.Wl[y.AQ],parent:aa,xfdf:"<add>".concat(x,"</add>")})):"modify"===e?(ha=b.querySelector('[name="'.concat(ca.Id,'"]')),x=w.serializeToString(ha),
f.annots.push({at:"modify",aId:ca.Id,xfdf:"<modify>".concat(x,"</modify>")})):"delete"===e&&f.annots.push({at:"delete",aId:ca.Id});0<f.annots.length&&y.connection.send(f);return[2]}})})}.bind(y);this.ha.addEventListener(ia.a.Events.ANNOTATION_CHANGED,this.Sp)};fa.Events={WEBVIEWER_SERVER_ANNOTATIONS_ENABLED:"webViewerServerAnnotationsEnabled",WEBVIEWER_SERVER_ANNOTATIONS_DISABLED:"webViewerServerAnnotationsDisabled"};return fa}();Object(ya.a)(h);ua["default"]=h}}]);}).call(this || window)
